<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Âncora Consultoria - Versão Trial</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body class="bg-login d-flex align-items-center justify-content-center">

   <div class="col-md-4 glass-panel p-5 text-center">
        <h3 class="mb-4 fw-bold text-dark">ÂNCORA <span class="text-primary">CONSULTORIA</span></h3>
        <p class="text-muted mb-4 small">Sistema de Gestão Privada</p>
        
        <div id="areaAcao">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
        </div>
        
        <div id="licencaMsg" class="mt-4 text-muted" style="font-size: 0.75rem; opacity: 0.8;">
            Verificando status...
        </div>
    </div>

    <footer>
        Âncora Consultoria Financeira &copy; Versão Trial
    </footer>

    <script src="app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Definição das chaves (devem bater com o app.js)
        const CHAVE_TRIAL = "ancora_trial_start";
        const CHAVE_DB = "consultoria_db";
        const CHAVE_SESSAO = "consultoria_logado";

        document.addEventListener("DOMContentLoaded", function() {
            const area = document.getElementById('areaAcao');
            const inicio = localStorage.getItem(CHAVE_TRIAL); 

            if (!inicio) {
                // --- CENÁRIO 1: USUÁRIO NOVO (OU RESETADO) ---
                area.innerHTML = `
                    <div class="alert alert-warning border-0 shadow-sm small mb-3 text-start">
                        <i class="bi bi-info-circle-fill"></i> 
                        Para iniciar o período de teste, é necessário configurar um novo ambiente.
                    </div>
                    <button onclick="solicitarInicioTrial()" class="btn btn-lg btn-success w-100 fw-bold shadow">
                        <i class="bi bi-play-fill"></i> COMEÇAR TESTE GRÁTIS
                        <div style="font-size: 0.7rem; font-weight: normal; opacity: 0.9">14 Dias de Acesso</div>
                    </button>
                `;
                const msg = document.getElementById('licencaMsg');
                if(msg) msg.innerHTML = "<span class='badge bg-light text-dark border'>Status: Aguardando Início</span>";
            
            } else {
                // --- CENÁRIO 2: USUÁRIO JÁ ATIVO ---
                area.innerHTML = `
                    <div class="alert alert-primary border-0 bg-opacity-10 small mb-3 text-primary fw-bold">
                        <i class="bi bi-check-circle-fill"></i> Sessão Ativa
                    </div>
                    <button onclick="acessarSistema()" class="btn btn-lg btn-primary w-100 fw-bold shadow">
                        <i class="bi bi-box-arrow-in-right"></i> CONTINUAR TRABALHO
                    </button>
                    <div class="mt-3">
                    </div>
                `;
                // O app.js vai atualizar o #licencaMsg com os dias restantes automaticamente
            }
        });

        function solicitarInicioTrial() {
            // Verifica se existem dados antigos que seriam perdidos
            if(localStorage.getItem(CHAVE_DB)) {
                // CHAMA O SEU MODAL BONITO (definido no app.js)
                // Note que passamos uma função (callback) para ser executada se ele clicar "Sim"
                exibirConfirmacao(
                    "ATENÇÃO: Já existem dados salvos neste navegador.<br><br>Iniciar um novo período de teste <strong>APAGARÁ TODOS</strong> os clientes e registros atuais.<br><br>Deseja realmente zerar o sistema e começar?", 
                    function() {
                        executarWipeAndStart();
                    }
                );
            } else {
                // Se não tem dados, não precisa assustar, só vai.
                executarWipeAndStart();
            }
        }

        function executarWipeAndStart() {
            // 1. Apaga tudo (Terra Arrasada)
            localStorage.removeItem(CHAVE_DB);
            localStorage.removeItem(CHAVE_TRIAL);

            // 2. Define o marco zero (Agora)
            const agora = new Date().toISOString();
            localStorage.setItem(CHAVE_TRIAL, agora);
            
            // 3. Define sessão como logada
            sessionStorage.setItem(CHAVE_SESSAO, "true");
            
            // 4. Feedback visual e Redirecionamento
            const btn = document.querySelector('button.btn-success');
            if(btn) {
                btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Preparando ambiente...';
                btn.disabled = true;
            }
            
            setTimeout(() => {
                window.location.href = 'clientes.html';
            }, 800);
        }

        function acessarSistema() {
            sessionStorage.setItem(CHAVE_SESSAO, "true");
            window.location.href = 'clientes.html';
        }
        
        // Função extra caso o usuário queira resetar voluntariamente estando no modo "Continuar"
        function forcarReset() {
             exibirConfirmacao(
                "Tem certeza absoluta? Isso vai reiniciar seu período de teste, mas <strong>VOCÊ PERDERÁ TODOS OS DADOS</strong> cadastrados até agora.", 
                function() {
                    executarWipeAndStart();
                }
            );
        }
    </script>
</body>
</html>